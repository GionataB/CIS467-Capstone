<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: routing/user/router_user.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: routing/user/router_user.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * The module contains a set of provided short hand mongoose query calls.
 * The queries provided should be used by the user side of the front-end.
 * @module routing/user/router_user
 * @requires error_handling/Error
 * @requires express
 * @requires schemas/admin/question_schema
 * @requires schemas/admin/course_schema
 * @requires config/routes
 * @requires routing/user/queries/queries
 * @requires routines/http_routines
 */

const error_handler = require('../../error_handling/Error');
const express = require('express');
const router = express.Router();

const db_user_question = require('../../schemas/admin/question_schema');
const db_user_course = require('../../schemas/admin/course_schema');
const {userRoute} = require('../../config/routes');
const queries = require('./queries/queries');
const routines = require('../../routines/http_routines');


/**
 * Callback function used by express.Router.route.get function.
 * the get function is used to request a database entry from an
 * ObjectId contained in the req.body part of the request.
 * @param {Object} req the http request
 * @param {Object} res the http response
 */
function cb_get(req, res){
  var returningUser = req.session.returning;
  var cookies = req.query.cookies;
  if(cookies == null) cookies = false;
  if (returningUser || !cookies) {
    var close = false;
    var run = true;
    var link = req.query.newlink;
    //this supports for the user to start where they left, if they disconnect.
    if (link == null) link = req.session.lastLink;
    else req.session.lastLink = link;
    var type = req.query.type;
    var database = db_user_question;
    switch (type) {
      case 'Question':
        database = db_user_question;
        break;
      
      case 'Course':
        database = db_user_course;
        close = true;
        break;

      default:
        error_handler.badClientRequest(res, `Type ${type} does not exist.`);
        run = false;
        break;
    }
    if(run){
      routines.get_one_check_closure(req, res, queries, database, {tag: link}, '', close);
    }
  }
  else {
    routines.get_init(req, res, queries, db_user_question, {tag: 'Initial'}, '');
    //Setting up session storage.
    req.session.returning = true;
    req.session.history = [];
  }
}

/**
 * Callback function to store the selected answers with the rest of the history.
 * At the end, it sends back a response with the full history array.
 * @param {Object} req the http request
 * @param {Object} res the http response
 */
function cb_post(req, res){
  var data = req.body;
  routines.log_data(req.session.history, data, result =>{
    req.session.history = result;
    res.status(201).json(req.session.history);
  });
}

router.route(userRoute).get(cb_get);

router.route(userRoute).post(cb_post);

module.exports = router;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-config_keys.html">config/keys</a></li><li><a href="module-config_routes.html">config/routes</a></li><li><a href="module-error_handling_Error.html">error_handling/Error</a></li><li><a href="module-routines_http_routines.html">routines/http_routines</a></li><li><a href="module-routing_admin_course_admin.html">routing/admin/course_admin</a></li><li><a href="module-routing_admin_queries_admin_queries.html">routing/admin/queries/admin_queries</a></li><li><a href="module-routing_admin_question_admin.html">routing/admin/question_admin</a></li><li><a href="module-routing_root_route.html">routing/root_route</a></li><li><a href="module-routing_user_queries_queries.html">routing/user/queries/queries</a></li><li><a href="module-routing_user_router_user.html">routing/user/router_user</a></li><li><a href="module-schemas_admin_course_schema.html">schemas/admin/course_schema</a></li><li><a href="module-schemas_admin_question_schema.html">schemas/admin/question_schema</a></li><li><a href="module-server.html">server</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Tue Dec 10 2019 00:28:42 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
